{"paragraphs":[{"text":"%python\nimport pandas as pd\n\nstock_list = [100, 98, 95, 96, 99, 102, 103, 105, 105, 108]\n\ndf = pd.DataFrame({'price':stock_list})\ndf","user":"anonymous","dateUpdated":"2022-09-26T17:15:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   price\n0    100\n1     98\n2     95\n3     96\n4     99\n5    102\n6    103\n7    105\n8    105\n9    108"}]},"apps":[],"jobName":"paragraph_1664210398361_-625863257","id":"20220926-163958_446227151","dateCreated":"2022-09-26T16:39:58+0000","dateStarted":"2022-09-26T17:14:36+0000","dateFinished":"2022-09-26T17:14:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3794"},{"text":"%python\ndf['prev_price'] = df['price'].shift(1)\ndf","user":"anonymous","dateUpdated":"2022-09-26T17:15:24+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   price  prev_price\n0    100         NaN\n1     98       100.0\n2     95        98.0\n3     96        95.0\n4     99        96.0\n5    102        99.0\n6    103       102.0\n7    105       103.0\n8    105       105.0\n9    108       105.0"}]},"apps":[],"jobName":"paragraph_1664212460194_-1410170983","id":"20220926-171420_1357887532","dateCreated":"2022-09-26T17:14:20+0000","dateStarted":"2022-09-26T17:15:24+0000","dateFinished":"2022-09-26T17:15:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3795"},{"text":"%python\ndf['prev_delta'] = df['price'] - df['prev_price']\ndf","user":"anonymous","dateUpdated":"2022-09-26T17:16:31+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   price  prev_price  prev_delta\n0    100         NaN         NaN\n1     98       100.0        -2.0\n2     95        98.0        -3.0\n3     96        95.0         1.0\n4     99        96.0         3.0\n5    102        99.0         3.0\n6    103       102.0         1.0\n7    105       103.0         2.0\n8    105       105.0         0.0\n9    108       105.0         3.0"}]},"apps":[],"jobName":"paragraph_1664212542795_-1420621003","id":"20220926-171542_1164649449","dateCreated":"2022-09-26T17:15:42+0000","dateStarted":"2022-09-26T17:16:31+0000","dateFinished":"2022-09-26T17:16:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3796"},{"text":"%python\ndf['expand'] = df['prev_delta'].expanding().mean()\ndf","user":"anonymous","dateUpdated":"2022-09-26T17:18:13+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   price  prev_price  prev_delta    expand\n0    100         NaN         NaN       NaN\n1     98       100.0        -2.0 -2.000000\n2     95        98.0        -3.0 -2.500000\n3     96        95.0         1.0 -1.333333\n4     99        96.0         3.0 -0.250000\n5    102        99.0         3.0  0.400000\n6    103       102.0         1.0  0.500000\n7    105       103.0         2.0  0.714286\n8    105       105.0         0.0  0.625000\n9    108       105.0         3.0  0.888889"}]},"apps":[],"jobName":"paragraph_1664212576494_985757492","id":"20220926-171616_636503586","dateCreated":"2022-09-26T17:16:16+0000","dateStarted":"2022-09-26T17:18:13+0000","dateFinished":"2022-09-26T17:18:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3797"},{"text":"%python\ndf['rolling'] = df['prev_delta'].rolling(3).mean()\ndf","user":"anonymous","dateUpdated":"2022-09-26T17:19:44+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   price  prev_price  prev_delta    expand   rolling\n0    100         NaN         NaN       NaN       NaN\n1     98       100.0        -2.0 -2.000000       NaN\n2     95        98.0        -3.0 -2.500000       NaN\n3     96        95.0         1.0 -1.333333 -1.333333\n4     99        96.0         3.0 -0.250000  0.333333\n5    102        99.0         3.0  0.400000  2.333333\n6    103       102.0         1.0  0.500000  2.333333\n7    105       103.0         2.0  0.714286  2.000000\n8    105       105.0         0.0  0.625000  1.000000\n9    108       105.0         3.0  0.888889  1.666667"}]},"apps":[],"jobName":"paragraph_1664212579065_-760259586","id":"20220926-171619_1085468878","dateCreated":"2022-09-26T17:16:19+0000","dateStarted":"2022-09-26T17:19:44+0000","dateFinished":"2022-09-26T17:19:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3798"},{"text":"%python\n","user":"anonymous","dateUpdated":"2022-09-26T17:16:19+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664212579762_-615220285","id":"20220926-171619_1107445618","dateCreated":"2022-09-26T17:16:19+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3799"},{"text":"%python\n","user":"anonymous","dateUpdated":"2022-09-26T17:16:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664212580308_1921939435","id":"20220926-171620_1049694897","dateCreated":"2022-09-26T17:16:20+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3800"},{"text":"%python\n","user":"anonymous","dateUpdated":"2022-09-26T17:16:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664212580918_908567275","id":"20220926-171620_790711734","dateCreated":"2022-09-26T17:16:20+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3801"},{"text":"%pyspark\nfrom pyspark.sql import SparkSession\n\nspark = SparkSession \\\n    .builder \\\n    .appName(\"lesson_7\") \\\n    .getOrCreate()\n","user":"anonymous","dateUpdated":"2022-09-26T17:25:44+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1664210692799_-925832352","id":"20220926-164452_1312879520","dateCreated":"2022-09-26T16:44:52+0000","dateStarted":"2022-09-26T17:25:45+0000","dateFinished":"2022-09-26T17:31:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3802"},{"text":"%pyspark\nimport pandas as pd\n\nstock_list = [100, 100, 95, 96, 99, 102, 103, 105, 105, 108]\n\ndf = pd.DataFrame({'price':stock_list})\n\ndf['shop'] = [1, 1, 2, 2, 2, 2, 3, 3, 3, 4]\n","user":"anonymous","dateUpdated":"2022-09-26T17:39:59+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1664213144120_1112733834","id":"20220926-172544_1265291842","dateCreated":"2022-09-26T17:25:44+0000","dateStarted":"2022-09-26T17:39:59+0000","dateFinished":"2022-09-26T17:40:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3803"},{"text":"%pyspark\ndf_spark = spark.createDataFrame(df)\ndf_spark.show()","user":"anonymous","dateUpdated":"2022-09-26T17:40:03+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+----+\n|price|shop|\n+-----+----+\n|  100|   1|\n|  100|   1|\n|   95|   2|\n|   96|   2|\n|   99|   2|\n|  102|   2|\n|  103|   3|\n|  105|   3|\n|  105|   3|\n|  108|   4|\n+-----+----+\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=6"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1664213180145_-692683203","id":"20220926-172620_1212252501","dateCreated":"2022-09-26T17:26:20+0000","dateStarted":"2022-09-26T17:40:03+0000","dateFinished":"2022-09-26T17:40:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3804"},{"text":"%pyspark\n\nfrom pyspark.sql.window import Window\n\n# .sort(F.col('price').desc())\nw = Window.partitionBy('shop').orderBy('price')\n","user":"anonymous","dateUpdated":"2022-09-26T17:37:00+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1664213185105_-1266982786","id":"20220926-172625_742770498","dateCreated":"2022-09-26T17:26:25+0000","dateStarted":"2022-09-26T17:37:00+0000","dateFinished":"2022-09-26T17:37:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3805"},{"text":"%pyspark\n\nw_empty = Window.partitionBy().orderBy('price')","user":"anonymous","dateUpdated":"2022-09-26T17:48:38+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664214442703_-1797104651","id":"20220926-174722_575129979","dateCreated":"2022-09-26T17:47:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5038","dateFinished":"2022-09-26T17:48:40+0000","dateStarted":"2022-09-26T17:48:38+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nimport pyspark.sql.functions as F\n\n(\n    df_spark\n    .withColumn('row_number', F.row_number().over(w))\n    .withColumn('rank', F.rank().over(w))\n    .withColumn('dense_rank', F.dense_rank().over(w))\n    .withColumn('ntile_2', F.ntile(2).over(w_empty))\n    .withColumn('ntile_4', F.ntile(4).over(w_empty))\n).show()\n","user":"anonymous","dateUpdated":"2022-09-26T17:48:44+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+----+----------+----+----------+-------+-------+\n|price|shop|row_number|rank|dense_rank|ntile_2|ntile_4|\n+-----+----+----------+----+----------+-------+-------+\n|   95|   2|         1|   1|         1|      1|      1|\n|   96|   2|         2|   2|         2|      1|      1|\n|   99|   2|         3|   3|         3|      1|      1|\n|  100|   1|         1|   1|         1|      1|      2|\n|  100|   1|         2|   1|         1|      1|      2|\n|  102|   2|         4|   4|         4|      2|      2|\n|  103|   3|         1|   1|         1|      2|      3|\n|  105|   3|         2|   2|         2|      2|      3|\n|  105|   3|         3|   2|         2|      2|      4|\n|  108|   4|         1|   1|         1|      2|      4|\n+-----+----+----------+----+----------+-------+-------+\n\n"}]},"apps":[],"jobName":"paragraph_1664213183311_1643778067","id":"20220926-172623_1010944413","dateCreated":"2022-09-26T17:26:23+0000","dateStarted":"2022-09-26T17:48:44+0000","dateFinished":"2022-09-26T17:49:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3806","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=12"],"interpreterSettingId":"spark"}}},{"text":"%pyspark\n# проверка пустых значений\ndf.filter(F.col('col').isNull())\n# проверка не пустых значений\ndf.filter(~F.col('col').isNull())","user":"anonymous","dateUpdated":"2022-09-26T18:05:45+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664213181891_-940810269","id":"20220926-172621_455427540","dateCreated":"2022-09-26T17:26:21+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3807"},{"text":"%pyspark\n!curl \"https://s3.amazonaws.com/apache-zeppelin/tutorial/bank/\"","user":"anonymous","dateUpdated":"2022-09-26T18:30:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664213178416_117500481","id":"20220926-172618_387082290","dateCreated":"2022-09-26T17:26:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3808","dateFinished":"2022-09-26T18:31:00+0000","dateStarted":"2022-09-26T18:30:56+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<Error><Code>AccessDenied</Code><Message>Access Denied</Message><RequestId>TRSV86SXWZY8XBDP</RequestId><HostId>XiDbMgl+TRoP8+/rzHbK2gpZFnYBKg98bfU2tZZTLycwY5gn0mxyW3Ud56D22pfkyK+FrlAD+zU=</HostId></Error>"}]}},{"text":"%pyspark\nsc = spark.sparkContext\nurl = 'https://s3.amazonaws.com/apache-zeppelin/tutorial/bank/bank.csv'\nfrom pyspark import SparkFiles\nsc.addFile(url)","user":"anonymous","dateUpdated":"2022-09-26T18:33:47+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664217056491_-1153920306","id":"20220926-183056_831336444","dateCreated":"2022-09-26T18:30:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5191","dateFinished":"2022-09-26T18:33:53+0000","dateStarted":"2022-09-26T18:33:47+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n# скачивание датасета банк\nwget http://archive.ics.uci.edu/ml/machine-learning-databases/00222/bank.zip\nmv bank.zip /data/\nunzip /data/bank.zip -d /data/","user":"anonymous","dateUpdated":"2022-09-26T18:33:47+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664217227319_455097012","id":"20220926-183347_939988717","dateCreated":"2022-09-26T18:33:47+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5288"}],"name":"lesson_7","id":"2HFY3XVQD","noteParams":{},"noteForms":{},"angularObjects":{"python:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}